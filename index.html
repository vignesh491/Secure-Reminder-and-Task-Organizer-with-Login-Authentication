<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple To-Do List (No-Backend)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a2f;
      --muted:#8ea0c0;
      --text:#e7ecf7;
      --brand:#6ea8fe;
      --accent:#7df9c6;
      --danger:#ff6b6b;
      --warning:#ffd166;
      --ok:#06d6a0;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% -10%, #1a2240 0, transparent 60%),
                  radial-gradient(700px 400px at 110% 10%, #182040 0, transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .container{
      max-width:1100px;
      margin:40px auto;
      padding:0 16px;
    }
    .header{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-bottom:20px;
    }
    h1{font-size:28px;margin:0;letter-spacing:.2px}
    .tagline{color:var(--muted);font-size:14px;margin-top:6px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(8px);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
    }
    .auth, .app{padding:20px}
    .tabs{
      display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap;
    }
    .tab{
      padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.08);
      background:#0f162a;color:var(--text);cursor:pointer;user-select:none;
      transition:.2s;
    }
    .tab.active{background:var(--brand);border-color:transparent;color:#081023}
    .grid{
      display:grid;grid-template-columns:repeat(12,1fr);gap:12px;
    }
    .col-6{grid-column: span 6}
    .col-4{grid-column: span 4}
    .col-3{grid-column: span 3}
    .col-12{grid-column: span 12}
    @media (max-width:820px){
      .col-6,.col-4,.col-3{grid-column:span 12}
    }
    label{display:block;font-size:13px;color:var(--muted);margin:8px 0 6px}
    input, textarea, select{
      width:100%;padding:12px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12); background:#0e1526; color:var(--text);
      outline:none; transition:border-color .2s, box-shadow .2s;
    }
    input:focus, textarea:focus, select:focus{
      border-color:var(--brand); box-shadow: 0 0 0 4px rgba(110,168,254,.15);
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{
      padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);
      background:#0f1730;color:var(--text);cursor:pointer;transition:.2s;
    }
    .btn.primary{background:var(--brand);color:#061224;border-color:transparent}
    .btn.ghost:hover{border-color:var(--brand)}
    .btn.warning{background:var(--warning); color:#1c1300; border-color:transparent}
    .btn.danger{background:var(--danger); color:#240808; border-color:transparent}
    .btn.success{background:var(--ok); color:#072017; border-color:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .otp-banner{
      margin:10px 0;padding:12px;border-radius:12px;background:#0f1a36;border:1px dashed rgba(255,255,255,.15);
      color:var(--accent);font-weight:600;letter-spacing:1px
    }
    .split{
      display:grid; grid-template-columns: 360px 1fr; gap:16px;
    }
    @media (max-width:980px){ .split{ grid-template-columns: 1fr } }
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px}
    .search{flex:1}
    table{width:100%; border-collapse: collapse; overflow:hidden; border-radius: 12px;}
    thead th{
      text-align:left; font-size:12px; color:var(--muted);
      background:#0e162c; border-bottom:1px solid rgba(255,255,255,.08); padding:12px;
    }
    tbody td{
      border-bottom:1px solid rgba(255,255,255,.06);
      padding:12px; vertical-align: top;
    }
    tbody tr:hover{ background: rgba(255,255,255,.02) }
    .badge{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      background:#102040; border:1px solid rgba(255,255,255,.08); font-size:12px; color:var(--muted)
    }
    .due-soon{ background: #3a2a00; color:#ffd166; border-color:#ffd16666 }
    .overdue{ background:#3a0c0c; color:#ffb3b3; border-color:#ff6b6b66 }
    .empty{
      text-align:center; padding:30px; color:var(--muted)
    }
    .pill{
      display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px;
      background:#0f203a; border:1px solid rgba(255,255,255,.08); color:var(--muted)
    }
    .link{color:var(--brand); cursor:pointer; text-decoration:underline}
    .footer-note{color:var(--muted); font-size:12px; margin-top:8px}
    .hidden{display:none !important}
    .toast{
      position: fixed; right: 16px; bottom: 16px; background: #0f1730; color: var(--text);
      border:1px solid rgba(255,255,255,.1); border-radius: 12px; padding: 12px 14px; box-shadow: var(--shadow);
      opacity: 0; transform: translateY(8px); transition: .3s; z-index: 9999;
    }
    .toast.show{opacity: 1; transform: translateY(0)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>Simple To‑Do List</h1>
        <div class="tagline">Add tasks in chronological order with deadlines, details, and client info — all in a single HTML file. No backend required.</div>
      </div>
      <div class="row">
        <button id="logoutBtn" class="btn ghost hidden">Logout</button>
      </div>
    </div>

    <!-- AUTH CARD -->
    <div id="authCard" class="card auth">
      <div class="tabs">
        <div class="tab active" data-tab="loginTab">Login</div>
        <div class="tab" data-tab="signupTab">Sign Up</div>
        <div class="tab" data-tab="forgotTab">Forgot Password</div>
      </div>

      <!-- LOGIN -->
      <div id="loginTab" class="tab-panel">
        <div class="grid">
          <div class="col-6">
            <label>User ID (number)</label>
            <input id="loginUserId" type="number" placeholder="e.g., 101"/>
          </div>
          <div class="col-6">
            <label>Password</label>
            <input id="loginPassword" type="password" placeholder="••••••••"/>
          </div>
          <div class="col-12"><button id="loginBtn" class="btn primary">Login</button></div>
          <div id="loginOtpArea" class="col-12 hidden">
            <div class="otp-banner">Your OTP is: <span id="loginOtp" class="mono"></span></div>
            <label>Enter OTP</label>
            <input id="loginOtpInput" placeholder="6-digit OTP"/>
            <div class="row" style="margin-top:8px">
              <button id="verifyLoginOtpBtn" class="btn success">Verify OTP</button>
              <button id="resendLoginOtpBtn" class="btn">Resend OTP</button>
            </div>
            <div class="footer-note">For demo purposes, OTP is shown above (no SMS backend).</div>
          </div>
        </div>
      </div>

      <!-- SIGNUP -->
      <div id="signupTab" class="tab-panel hidden">
        <div class="grid">
          <div class="col-6">
            <label>Create User ID (number)</label>
            <input id="signupUserId" type="number" placeholder="Choose a unique number"/>
          </div>
          <div class="col-6">
            <label>Create Password</label>
            <input id="signupPassword" type="password" placeholder="At least 6 characters"/>
          </div>
          <div class="col-12"><button id="signupBtn" class="btn primary">Create Account</button></div>
        </div>
      </div>

      <!-- FORGOT -->
      <div id="forgotTab" class="tab-panel hidden">
        <div class="grid">
          <div class="col-6">
            <label>Your User ID</label>
            <input id="forgotUserId" type="number" placeholder="Registered number ID"/>
          </div>
          <div class="col-6">
            <label>New Password</label>
            <input id="forgotNewPass" type="password" placeholder="New strong password"/>
          </div>
          <div class="col-12"><button id="forgotBtn" class="btn warning">Generate OTP</button></div>

          <div id="forgotOtpArea" class="col-12 hidden">
            <div class="otp-banner">Your OTP is: <span id="forgotOtp" class="mono"></span></div>
            <label>Enter OTP</label>
            <input id="forgotOtpInput" placeholder="6-digit OTP"/>
            <div class="row" style="margin-top:8px">
              <button id="verifyForgotOtpBtn" class="btn success">Verify & Reset Password</button>
              <button id="resendForgotOtpBtn" class="btn">Resend OTP</button>
            </div>
            <div class="footer-note">For demo purposes, OTP is shown above (no SMS backend).</div>
          </div>
        </div>
      </div>
    </div>

    <!-- APP CARD -->
    <div id="appCard" class="card app hidden">
      <div class="split">
        <!-- Left: Add / Edit form -->
        <div class="card" style="padding:16px">
          <h3 style="margin:6px 0 12px">Add / Edit Task</h3>
          <div class="grid">
            <div class="col-12">
              <label>Task Name</label>
              <input id="taskName" placeholder="Build login UI"/>
            </div>
            <div class="col-12">
              <label>Task Details</label>
              <textarea id="taskDetails" placeholder="Short description / acceptance criteria"></textarea>
            </div>
            <div class="col-6">
              <label>Deadline</label>
              <input id="taskDeadline" type="datetime-local"/>
            </div>
            <div class="col-6">
              <label>Client</label>
              <input id="taskClient" placeholder="ACME Corp."/>
            </div>
            <div class="col-12 row">
              <button id="addTaskBtn" class="btn primary">Save Task</button>
              <button id="resetFormBtn" class="btn">Reset</button>
            </div>
            <div class="col-12 footer-note">Tasks are stored locally in your browser per User ID.</div>
          </div>
        </div>

        <!-- Right: List / actions -->
        <div>
          <div class="toolbar">
            <input id="searchBox" class="search" placeholder="Search tasks by name, details, client..."/>
            <select id="sortSelect" title="Sort">
              <option value="deadlineAsc">Deadline ↑ (chronological)</option>
              <option value="deadlineDesc">Deadline ↓</option>
              <option value="createdDesc">Recently added</option>
              <option value="createdAsc">Oldest first</option>
            </select>
            <button id="viewAllBtn" class="btn ghost">View All</button>
            <button id="exportBtn" class="btn ghost">Export JSON</button>
            <input id="importFile" type="file" accept="application/json" class="hidden"/>
            <button id="importBtn" class="btn ghost">Import JSON</button>
          </div>

          <div class="card" style="padding:0">
            <table>
              <thead>
                <tr>
                  <th style="width:60px">#</th>
                  <th>Task</th>
                  <th>Details</th>
                  <th style="width:170px">Deadline</th>
                  <th style="width:150px">Client</th>
                  <th style="width:210px">Actions</th>
                </tr>
              </thead>
              <tbody id="taskTbody">
                <!-- rows injected -->
              </tbody>
            </table>
            <div id="emptyState" class="empty hidden">No tasks yet. Add your first task on the left ✨</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    /********************
     * Utilities
     ********************/
    const $ = (s,scope=document)=>scope.querySelector(s);
    const $$ = (s,scope=document)=>Array.from(scope.querySelectorAll(s));
    const toast = (msg)=>{
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 2200);
    };
    const genOTP = ()=> String(Math.floor(100000 + Math.random()*900000));

    const STORAGE_KEY = "todo_app_v1";
    function getStore(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || { users:{/*id: {password, tasks:[]}*/} }; }
      catch(e){ return { users:{} }; }
    }
    function setStore(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

    function ensureUser(id){
      const store = getStore();
      if(!store.users[id]) store.users[id] = { password:"", tasks:[] };
      setStore(store);
    }

    let session = { userId:null, otp:null, pendingAction:null, editingIndex:null };

    /********************
     * Tabs (Auth)
     ********************/
    $$(".tab").forEach(tab=>{
      tab.addEventListener("click",()=>{
        $$(".tab").forEach(t=>t.classList.remove("active"));
        tab.classList.add("active");
        $$(".tab-panel").forEach(p=>p.classList.add("hidden"));
        const id = tab.getAttribute("data-tab");
        $("#"+id).classList.remove("hidden");
      });
    });

    /********************
     * Sign Up
     ********************/
    $("#signupBtn").addEventListener("click", ()=>{
      const id = ($("#signupUserId").value||"").trim();
      const pass = ($("#signupPassword").value||"").trim();
      if(!id || isNaN(Number(id))) return toast("Please enter a numeric User ID.");
      if(!pass || pass.length<4) return toast("Password should be at least 4 characters.");
      const store = getStore();
      if(store.users[id]) return toast("User ID already exists. Try logging in.");
      store.users[id] = { password: pass, tasks:[] };
      setStore(store);
      toast("Signup successful. Please login.");
      // switch to login tab
      $$("[data-tab='loginTab']")[0].click();
    });

    /********************
     * Login + OTP
     ********************/
    $("#loginBtn").addEventListener("click", ()=>{
      const id = ($("#loginUserId").value||"").trim();
      const pass = ($("#loginPassword").value||"").trim();
      if(!id) return toast("Enter your User ID.");
      const store = getStore();
      if(!store.users[id]) return toast("User ID not found.");
      if(store.users[id].password !== pass) return toast("Wrong password.");
      // generate and show OTP
      session.userId = id;
      session.otp = genOTP();
      $("#loginOtp").textContent = session.otp;
      $("#loginOtpArea").classList.remove("hidden");
      toast("OTP generated.");
    });
    $("#resendLoginOtpBtn").addEventListener("click", ()=>{
      if(!session.userId) return toast("Enter login details first.");
      session.otp = genOTP();
      $("#loginOtp").textContent = session.otp;
      toast("New OTP generated.");
    });
    $("#verifyLoginOtpBtn").addEventListener("click", ()=>{
      const input = ($("#loginOtpInput").value||"").trim();
      if(input === session.otp){
        toast("Authentication success.");
        $("#authCard").classList.add("hidden");
        $("#appCard").classList.remove("hidden");
        $("#logoutBtn").classList.remove("hidden");
        loadTasks();
      }else{
        toast("Incorrect OTP.");
      }
    });

    /********************
     * Forgot Password + OTP
     ********************/
    $("#forgotBtn").addEventListener("click", ()=>{
      const id = ($("#forgotUserId").value||"").trim();
      if(!id) return toast("Enter your User ID.");
      const store = getStore();
      if(!store.users[id]) return toast("User ID not found.");
      session.userId = id;
      session.otp = genOTP();
      $("#forgotOtp").textContent = session.otp;
      $("#forgotOtpArea").classList.remove("hidden");
      toast("OTP generated.");
    });
    $("#resendForgotOtpBtn").addEventListener("click", ()=>{
      if(!session.userId) return toast("Enter your User ID first.");
      session.otp = genOTP();
      $("#forgotOtp").textContent = session.otp;
      toast("New OTP generated.");
    });
    $("#verifyForgotOtpBtn").addEventListener("click", ()=>{
      const input = ($("#forgotOtpInput").value||"").trim();
      const newPass = ($("#forgotNewPass").value||"").trim();
      if(!newPass || newPass.length<4) return toast("New password must be at least 4 characters.");
      if(input === session.otp){
        const store = getStore();
        store.users[session.userId].password = newPass;
        setStore(store);
        toast("Password reset successful. Please login.");
        // reset area and move to login tab
        $("#forgotOtpArea").classList.add("hidden");
        $$("[data-tab='loginTab']")[0].click();
      }else{
        toast("Incorrect OTP.");
      }
    });

    /********************
     * Logout
     ********************/
    $("#logoutBtn").addEventListener("click", ()=>{
      session = { userId:null, otp:null, pendingAction:null, editingIndex:null };
      $("#appCard").classList.add("hidden");
      $("#authCard").classList.remove("hidden");
      $("#logoutBtn").classList.add("hidden");
      toast("Logged out.");
      // reset OTP UI
      $("#loginOtpArea").classList.add("hidden");
      $("#loginOtpInput").value="";
    });

    /********************
     * Tasks
     ********************/
    function loadTasks(){
      const store = getStore();
      ensureUser(session.userId);
      const tasks = store.users[session.userId].tasks || [];
      renderTasks(tasks);
    }

    function persistTasks(tasks){
      const store = getStore();
      ensureUser(session.userId);
      store.users[session.userId].tasks = tasks;
      setStore(store);
    }

    function renderTasks(tasks){
      const q = ($("#searchBox").value||"").toLowerCase();
      const sort = $("#sortSelect").value;
      // filter
      let view = tasks.filter(t=>
        t.name.toLowerCase().includes(q) ||
        t.details.toLowerCase().includes(q) ||
        t.client.toLowerCase().includes(q)
      );
      // sort
      view.sort((a,b)=>{
        if(sort==="deadlineAsc"){
          return (a.deadline||"") > (b.deadline||"") ? 1 : -1;
        }else if(sort==="deadlineDesc"){
          return (a.deadline||"") < (b.deadline||"") ? 1 : -1;
        }else if(sort==="createdAsc"){
          return (a.created||0) - (b.created||0);
        }else{
          return (b.created||0) - (a.created||0);
        }
      });
      const tbody = $("#taskTbody");
      tbody.innerHTML = "";
      if(view.length===0){
        $("#emptyState").classList.remove("hidden");
      }else{
        $("#emptyState").classList.add("hidden");
      }
      view.forEach((t, idx)=>{
        const tr = document.createElement("tr");

        const createdIndex = tasks.indexOf(t); // to map back for actions
        const now = new Date();
        const dl = t.deadline ? new Date(t.deadline) : null;
        let dueBadge = "";
        if(dl){
          const isOverdue = dl < now;
          const hoursLeft = Math.ceil((dl - now)/36e5);
          if(isOverdue){
            dueBadge = `<span class="badge overdue">Overdue</span>`;
          }else if(hoursLeft <= 24){
            dueBadge = `<span class="badge due-soon">Due in ${hoursLeft}h</span>`;
          }else{
            const d = Math.ceil(hoursLeft/24);
            dueBadge = `<span class="pill">${d} day(s) left</span>`;
          }
        }

        tr.innerHTML = `
          <td><span class="pill mono">${createdIndex}</span></td>
          <td><div style="font-weight:600">${escapeHTML(t.name)}</div></td>
          <td>${escapeHTML(t.details||"")}</td>
          <td>
            ${dl ? new Date(t.deadline).toLocaleString() : "-"}
            <div style="margin-top:6px">${dueBadge}</div>
          </td>
          <td>${escapeHTML(t.client||"-")}</td>
          <td>
            <div class="row">
              <button class="btn" data-action="retrieve" data-index="${createdIndex}">Retrieve</button>
              <button class="btn" data-action="edit" data-index="${createdIndex}">Edit</button>
              <button class="btn danger" data-action="delete" data-index="${createdIndex}">Delete</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function escapeHTML(str){
      return (str||"").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
      })[m]);
    }

    // Add / edit
    $("#addTaskBtn").addEventListener("click", ()=>{
      const name = ($("#taskName").value||"").trim();
      const details = ($("#taskDetails").value||"").trim();
      const deadline = $("#taskDeadline").value;
      const client = ($("#taskClient").value||"").trim();
      if(!name) return toast("Task name is required.");
      const store = getStore();
      const tasks = (store.users[session.userId].tasks)||[];
      if(session.editingIndex !== null && session.editingIndex !== undefined){
        tasks[session.editingIndex] = {
          ...tasks[session.editingIndex],
          name, details, deadline, client
        };
        toast("Task updated.");
      }else{
        tasks.push({ name, details, deadline, client, created: Date.now() });
        toast("Task added.");
      }
      persistTasks(tasks);
      renderTasks(tasks);
      resetForm();
    });

    $("#resetFormBtn").addEventListener("click", resetForm);
    function resetForm(){
      $("#taskName").value="";
      $("#taskDetails").value="";
      $("#taskDeadline").value="";
      $("#taskClient").value="";
      session.editingIndex = null;
      $("#addTaskBtn").textContent = "Save Task";
    }

    // Table actions
    $("#taskTbody").addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-action]");
      if(!btn) return;
      const idx = Number(btn.getAttribute("data-index"));
      const action = btn.getAttribute("data-action");
      const store = getStore();
      const tasks = store.users[session.userId].tasks || [];
      if(action==="delete"){
        if(confirm("Delete this task?")){
          tasks.splice(idx,1);
          persistTasks(tasks);
          renderTasks(tasks);
          toast("Task deleted.");
        }
      }else if(action==="edit"){
        const t = tasks[idx];
        $("#taskName").value = t.name;
        $("#taskDetails").value = t.details;
        $("#taskDeadline").value = t.deadline || "";
        $("#taskClient").value = t.client;
        session.editingIndex = idx;
        $("#addTaskBtn").textContent = "Update Task";
        toast("Loaded task into form for editing.");
      }else if(action==="retrieve"){
        const t = tasks[idx];
        alert(
          `Task #${idx}\n`+
          `Name: ${t.name}\n`+
          `Details: ${t.details || "-"}\n`+
          `Deadline: ${t.deadline ? new Date(t.deadline).toLocaleString() : "-"}\n`+
          `Client: ${t.client || "-"}\n`
        );
      }
    });

    // Search + sort
    $("#searchBox").addEventListener("input", ()=>{
      const store = getStore();
      const tasks = store.users[session.userId].tasks || [];
      renderTasks(tasks);
    });
    $("#sortSelect").addEventListener("change", ()=>{
      const store = getStore();
      const tasks = store.users[session.userId].tasks || [];
      renderTasks(tasks);
    });
    $("#viewAllBtn").addEventListener("click", ()=>{
      $("#searchBox").value="";
      const store = getStore();
      const tasks = store.users[session.userId].tasks || [];
      renderTasks(tasks);
    });

    // Export / Import
    $("#exportBtn").addEventListener("click", ()=>{
      const store = getStore();
      const data = { userId: session.userId, tasks: store.users[session.userId]?.tasks || [] };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `tasks_${session.userId}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });
    $("#importBtn").addEventListener("click", ()=>$("#importFile").click());
    $("#importFile").addEventListener("change", (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const data = JSON.parse(reader.result);
          if(!Array.isArray(data.tasks)) throw new Error("Invalid file");
          persistTasks(data.tasks.map(t=>({
            name: t.name||"", details: t.details||"", deadline: t.deadline||"", client: t.client||"", created: t.created||Date.now()
          })));
          loadTasks();
          toast("Import complete.");
        }catch(err){
          toast("Invalid JSON file.");
        }
      };
      reader.readAsText(file);
      e.target.value = "";
    });

    // Auto-focus helpfulness
    $("#taskName").addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ $("#taskDetails").focus(); } });

  </script>
</body>
</html>
